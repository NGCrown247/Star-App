(function(d){var L=function(n){return n},k=function(n){return d.isArray(n)},P=function(n){return!k(n)&&n instanceof Object},Q=function(n,c){return d.inArray(c,n)},U=function(n,c){return Q(n,c)!==-1},g=function(n,c){for(var u in n)n.hasOwnProperty(u)&&c(n[u],u,n)},D=function(n){return n[n.length-1]},z=function(n){return Array.prototype.slice.call(n)},F=function(){var n={};return g(z(arguments),function(c){g(c,function(u,f){n[f]=u})}),n},H=function(n,c){var u=[];return g(n,function(f,s,o){u.push(c(f,s,o))}),u},J=function(n,c,u){var f={};return g(n,function(s,o,h){o=u?u(o,s):o,f[o]=c(s,o,h)}),f},E=function(n,c,u){return k(n)?H(n,c):J(n,c,u)},K=function(n,c){return E(n,function(u){return u[c]})},M=function(n,c){var u;return k(n)?(u=[],g(n,function(f,s,o){c(f,s,o)&&u.push(f)})):(u={},g(n,function(f,s,o){c(f,s,o)&&(u[s]=f)})),u},q=function(n,c,u){return E(n,function(f,s){return f[c].apply(f,[])})},N=function(n){n=n||{};var c={};return n.publish=function(u,f){g(c[u],function(s){s(f)})},n.subscribe=function(u,f){c[u]=c[u]||[],c[u].push(f)},n.unsubscribe=function(u){g(c,function(f){var s=Q(f,u);s!==-1&&f.splice(s,1)})},n};(function(n){var c=function(i,t){var e=N(),r=i.$;return e.getType=function(){throw'implement me (return type. "text", "radio", etc.)'},e.$=function(a){return a?r.find(a):r},e.disable=function(){e.$().prop("disabled",!0),e.publish("isEnabled",!1)},e.enable=function(){e.$().prop("disabled",!1),e.publish("isEnabled",!0)},t.equalTo=function(a,y){return a===y},t.publishChange=function(){var a;return function(y,$){var v=e.get();t.equalTo(v,a)||e.publish("change",{e:y,domElement:$}),a=v}}(),e},u=function(i,t){var e=c(i,t);return e.get=function(){return e.$().val()},e.set=function(r){e.$().val(r)},e.clear=function(){e.set("")},t.buildSetter=function(r){return function(a){r.call(e,a)}},e},f=function(i,t){i=k(i)?i:[i],t=k(t)?t:[t];var e=!0;return i.length!==t.length?e=!1:g(i,function(r){U(t,r)||(e=!1)}),e},s=function(i){var t={},e=u(i,t);return e.getType=function(){return"button"},e.$().on("change",function(r){t.publishChange(r,this)}),e},o=function(i){var t={},e=u(i,t);return e.getType=function(){return"checkbox"},e.get=function(){var r=[];return e.$().filter(":checked").each(function(){r.push(n(this).val())}),r},e.set=function(r){r=k(r)?r:[r],e.$().each(function(){n(this).prop("checked",!1)}),g(r,function(a){e.$().filter('[value="'+a+'"]').prop("checked",!0)})},t.equalTo=f,e.$().change(function(r){t.publishChange(r,this)}),e},h=function(i){var t=T(i);return t.getType=function(){return"email"},t},b=function(i){var t={},e=c(i,t);return e.getType=function(){return"file"},e.get=function(){return D(e.$().val().split("\\"))},e.clear=function(){this.$().each(function(){n(this).wrap("<form>").closest("form").get(0).reset(),n(this).unwrap()})},e.$().change(function(r){t.publishChange(r,this)}),e},S=function(i){var t={},e=u(i,t);return e.getType=function(){return"hidden"},e.$().change(function(r){t.publishChange(r,this)}),e},O=function(i){var t={},e=c(i,t);return e.getType=function(){return"file[multiple]"},e.get=function(){var r=e.$().get(0).files||[],a=[],y;for(y=0;y<(r.length||0);y+=1)a.push(r[y].name);return a},e.clear=function(){this.$().each(function(){n(this).wrap("<form>").closest("form").get(0).reset(),n(this).unwrap()})},e.$().change(function(r){t.publishChange(r,this)}),e},w=function(i){var t={},e=u(i,t);return e.getType=function(){return"select[multiple]"},e.get=function(){return e.$().val()||[]},e.set=function(r){e.$().val(r===""?[]:k(r)?r:[r])},t.equalTo=f,e.$().change(function(r){t.publishChange(r,this)}),e},j=function(i){var t=T(i);return t.getType=function(){return"password"},t},A=function(i){var t={},e=u(i,t);return e.getType=function(){return"radio"},e.get=function(){return e.$().filter(":checked").val()||null},e.set=function(r){r?e.$().filter('[value="'+r+'"]').prop("checked",!0):e.$().each(function(){n(this).prop("checked",!1)})},e.$().change(function(r){t.publishChange(r,this)}),e},x=function(i){var t={},e=u(i,t);return e.getType=function(){return"range"},e.$().change(function(r){t.publishChange(r,this)}),e},B=function(i){var t={},e=u(i,t);return e.getType=function(){return"select"},e.$().change(function(r){t.publishChange(r,this)}),e},T=function(i){var t={},e=u(i,t);return e.getType=function(){return"text"},e.$().on("change keyup keydown",function(r){t.publishChange(r,this)}),e},p=function(i){var t={},e=u(i,t);return e.getType=function(){return"textarea"},e.$().on("change keyup keydown",function(r){t.publishChange(r,this)}),e},l=function(i){var t=T(i);return t.getType=function(){return"url"},t},m=function(i){var t={},e=i.$,r=i.constructorOverride||{button:s,text:T,url:l,email:h,password:j,range:x,textarea:p,select:B,"select[multiple]":w,radio:A,checkbox:o,file:b,"file[multiple]":O,hidden:S},a=function($,v){var C=P(v)?v:e.find(v);C.each(function(){var V=n(this).attr("name");t[V]=r[$]({$:n(this)})})},y=function($,v){var C=[],V=P(v)?v:e.find(v);P(v)?t[V.attr("name")]=r[$]({$:V}):(V.each(function(){Q(C,n(this).attr("name"))===-1&&C.push(n(this).attr("name"))}),g(C,function(I){t[I]=r[$]({$:e.find('input[name="'+I+'"]')})}))};return e.is("input, select, textarea")?e.is('input[type="button"], button, input[type="submit"]')?a("button",e):e.is("textarea")?a("textarea",e):e.is('input[type="text"]')||e.is("input")&&!e.attr("type")?a("text",e):e.is('input[type="password"]')?a("password",e):e.is('input[type="email"]')?a("email",e):e.is('input[type="url"]')?a("url",e):e.is('input[type="range"]')?a("range",e):e.is("select")?e.is("[multiple]")?a("select[multiple]",e):a("select",e):e.is('input[type="file"]')?e.is("[multiple]")?a("file[multiple]",e):a("file",e):e.is('input[type="hidden"]')?a("hidden",e):e.is('input[type="radio"]')?y("radio",e):e.is('input[type="checkbox"]')?y("checkbox",e):a("text",e):(a("button",'input[type="button"], button, input[type="submit"]'),a("text",'input[type="text"]'),a("password",'input[type="password"]'),a("email",'input[type="email"]'),a("url",'input[type="url"]'),a("range",'input[type="range"]'),a("textarea","textarea"),a("select","select:not([multiple])"),a("select[multiple]","select[multiple]"),a("file",'input[type="file"]:not([multiple])'),a("file[multiple]",'input[type="file"][multiple]'),a("hidden",'input[type="hidden"]'),y("radio",'input[type="radio"]'),y("checkbox",'input[type="checkbox"]')),t};n.fn.inputVal=function(i){var t=n(this),e=m({$:t});return t.is("input, textarea, select")?typeof i>"u"?e[t.attr("name")].get():(e[t.attr("name")].set(i),t):typeof i>"u"?q(e,"get"):(g(i,function(r,a){e[a].set(r)}),t)},n.fn.inputOnChange=function(i){var t=n(this),e=m({$:t});return g(e,function(r){r.subscribe("change",function(a){i.call(a.domElement,a.e)})}),t},n.fn.inputDisable=function(){var i=n(this);return q(m({$:i}),"disable"),i},n.fn.inputEnable=function(){var i=n(this);return q(m({$:i}),"enable"),i},n.fn.inputClear=function(){var i=n(this);return q(m({$:i}),"clear"),i}})(jQuery),d.fn.repeaterVal=function(){var n=function(u){var f=[];return g(u,function(s,o){var h=[];o!=="undefined"&&(h.push(o.match(/^[^\[]*/)[0]),h=h.concat(E(o.match(/\[[^\]]*\]/g),function(b){return b.replace(/[\[\]]/g,"")})),f.push({val:s,key:h}))}),f},c=function(u){if(u.length===1&&(u[0].key.length===0||u[0].key.length===1&&!u[0].key[0]))return u[0].val;g(u,function(o){o.head=o.key.shift()});var f=function(){var o={};return g(u,function(h){o[h.head]||(o[h.head]=[]),o[h.head].push(h)}),o}(),s;return/^[0-9]+$/.test(u[0].head)?(s=[],g(f,function(o){s.push(c(o))})):(s={},g(f,function(o,h){s[h]=c(o)})),s};return c(n(d(this).inputVal()))},d.fn.repeater=function(n){n=n||{};var c;return d(this).each(function(){var u=d(this),f=n.show||function(){d(this).show()},s=n.hide||function(p){p()},o=u.find("[data-repeater-list]").first(),h=function(p,l){return p.filter(function(){return l?d(this).closest(K(l,"selector").join(",")).length===0:!0})},b=function(){return h(o.find("[data-repeater-item]"),n.repeaters)},S=o.find("[data-repeater-item]").first().clone().hide(),O=h(h(d(this).find("[data-repeater-item]"),n.repeaters).first().find("[data-repeater-delete]"),n.repeaters);n.isFirstItemUndeletable&&O&&O.remove();var w=function(){var p=o.data("repeater-list");return n.$parent?n.$parent.data("item-name")+"["+p+"]":p},j=function(p){n.repeaters&&p.each(function(){var l=d(this);g(n.repeaters,function(m){l.find(m.selector).repeater(F(m,{$parent:l}))})})},A=function(p,l,m){p&&g(p,function(i){m.call(l.find(i.selector)[0],i)})},x=function(p,l,m){p.each(function(i){var t=d(this);t.data("item-name",l+"["+i+"]"),h(t.find("[name]"),m).each(function(){var e=d(this),r=e.attr("name").match(/\[[^\]]+\]/g),a=r?D(r).replace(/\[|\]/g,""):e.attr("name"),y=l+"["+i+"]["+a+"]"+(e.is(":checkbox")||e.attr("multiple")?"[]":"");e.attr("name",y),A(m,t,function($){var v=d(this);x(h(v.find("[data-repeater-item]"),$.repeaters||[]),l+"["+i+"]["+v.find("[data-repeater-list]").first().data("repeater-list")+"]",$.repeaters)})})}),o.find("input[name][checked]").removeAttr("checked").prop("checked",!0)};x(b(),w(),n.repeaters),j(b()),n.initEmpty&&b().remove(),n.ready&&n.ready(function(){x(b(),w(),n.repeaters)});var B=function(){var p=function(l,m,i){if(m||n.defaultValues){var t={};h(l.find("[name]"),i).each(function(){var e=d(this).attr("name").match(/\[([^\]]*)(\]|\]\[\])$/)[1];t[e]=d(this).attr("name")}),l.inputVal(E(M(m||n.defaultValues,function(e,r){return t[r]}),L,function(e){return t[e]}))}A(i,l,function(e){var r=d(this);h(r.find("[data-repeater-item]"),e.repeaters).each(function(){var a=r.find("[data-repeater-list]").data("repeater-list");if(m&&m[a]){var y=d(this).clone();r.find("[data-repeater-item]").remove(),g(m[a],function($){var v=y.clone();p(v,$,e.repeaters||[]),r.find("[data-repeater-list]").append(v)})}else p(d(this),e.defaultValues,e.repeaters||[])})})};return function(l,m){o.append(l),x(b(),w(),n.repeaters),l.find("[name]").each(function(){d(this).inputClear()}),p(l,m||n.defaultValues,n.repeaters)}}(),T=function(p){var l=S.clone();B(l,p),n.repeaters&&j(l),f.call(l.get(0))};c=function(p){b().remove(),g(p,T)},h(u.find("[data-repeater-create]"),n.repeaters).click(function(){T()}),o.on("click","[data-repeater-delete]",function(){var p=d(this).closest("[data-repeater-item]").get(0);s.call(p,function(){d(p).remove(),x(b(),w(),n.repeaters)})})}),this.setList=c,this}})(jQuery);
